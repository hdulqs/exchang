define(["backbone","template","Calculate","Prototype","ajax"],function(){var Backbone=require("backbone"),template=require("template"),Calculate=require("Calculate"),ajax=require("ajax"),wsData=[],thisView=null,currentSymbol=null,tenNoDeal={init:function(){thisView=new this.view({model:new this.model})},ajaxLoad:function(symbol){currentSymbol=symbol,thisView.model.set("symbol",symbol),thisView.render()},socketRefresh:function(data,symbol){if(data&&!(data.length<1)){if(currentSymbol=symbol,0!==wsData.length&&data.length<60){wsData=data.concat(wsData);for(var temp={},arr=[],i=0;i<wsData.length;i++)temp[wsData[i].id.toString()]||(temp[wsData[i].id.toString()]=wsData[i],arr.push(wsData[i]));arr.length>60&&(arr=arr.slice(0,60)),wsData=arr}else wsData=data;wsData.sort(function(d1,d2){return d2.createdDate-d1.createdDate}),thisView.model.set("data",wsData)}},view:Backbone.View.extend({el:$("#lastDeal"),events:{},initialize:function(){this.model.bind("change:data",this.updateTenNoDeal,this)},render:function(){this.model.fetch()},updateTenNoDeal:function(){var data=this.model.get("data");tenNoDeal.dealsTemplate(data)}}),dealsTemplate:function(data){var getLocalTime=function(nS){return new Date(parseInt(nS)).Format("hh:mm:ss")},baseCoinSymbol=currentSymbol.split("_")[1].toUpperCase(),tradeCoinSymbol=currentSymbol.split("_")[0].toUpperCase();thisView.$el.find("#baseCoinSymbol").html(baseCoinSymbol),thisView.$el.find("#tradeCoinSymbol").html(tradeCoinSymbol);var $dealsBody=thisView.$el.find("#marketRecentBody"),$dealsBodyRows=$dealsBody.find("tr"),colorArr={1:"green",2:"red"};$dealsBodyRows.length<60||data.length<$dealsBodyRows.length?$dealsBody.html(template("lastDealTemplate",{getLocalTime:getLocalTime,Calculate:Calculate,priceTruncate:ok.priceTruncate(currentSymbol),amountTruncate:ok.amountTruncate(currentSymbol),deals:data})):$dealsBodyRows.each(function(index,row){var deal=data[index],sideColor=colorArr[deal.side],time=getLocalTime(deal.createdDate),price=Calculate.ShowDownTruncation(deal.price,ok.priceTruncate(currentSymbol)),amount=Calculate.ShowDownTruncation(deal.amount,ok.amountTruncate(currentSymbol));$(row).find("td:eq(0)").html(time),$(row).find("td:eq(1)").html(price),$(row).find("td:eq(2) span").attr("class",sideColor).html(amount)})},model:Backbone.Model.extend({defaults:{data:{}},sync:function(){var thisModel=this,symbol=this.get("symbol");ajax.getDealOrderDepth({opt:{symbol:symbol},success:function(data){!data||data.length<1||(data.sort(function(d1,d2){return d2.createdDate-d1.createdDate}),thisModel.set("data",data))},fail:function(err){}})}})};return tenNoDeal});