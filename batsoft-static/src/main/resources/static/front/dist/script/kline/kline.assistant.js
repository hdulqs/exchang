function Kline(){}function keepalive(a){var b=(new Date).getTime();0==a.bufferedAmount&&a.send("{time:"+b+"}")}Kline.prototype={browerState:0,klineWebsocket:null,klineTradeInit:!1,tradeDate:new Date,tradesLimit:100,lastDepth:null,depthShowSize:30,priceDecimalDigits:2,amountDecimalDigits:4,symbol:null,depthChannel:null,tradeChannel:null,curPrice:null,title:"",ajaxRe:!1,last_trade_tid:0,moneyDecimal:{chbtcbtccny:2,chbtcbcccny:2,chbtcltccny:2,chbtcethcny:2,chbtcethbtc:6,chbtcetccny:2,chbtcbtscny:4,chbtcqtumcny:2,chbtchsrcny:2,chbtceoscny:2},coinDecimal:{chbtcbtccny:3,chbtcbcccny:3,chbtcltccny:2,chbtcethcny:3,chbtcethbtc:2,chbtcetccny:3,chbtcbtscny:1,chbtcqtumcny:3,chbtchsrcny:3,chbtceoscny:3},initWebSocket:function(){var c=this,b=0,a=setInterval(function(){b+=50,b>=1e4&&clearInterval(a),parent.webSocket&&(parent.webSocket.init(function(){parent.webSocket.sendMessage('{"event":"addChannel","channel":"'+c.depthChannel+'","isZip":"'+parent.isZipData()+'"}'),parent.webSocket.sendMessage('{"event":"addChannel","channel":"'+c.tradeChannel+'","isZip":"'+parent.isZipData()+'"}')}),clearInterval(a))},50)},reset:function(a){var b=this;this.refreshUrl(a),$("#markettop li a").removeClass("selected"),$("#markettop li."+a+" a").addClass("selected"),this.symbol=a,this.lastDepth=null,this.curPrice=null,this.klineTradeInit=!1,$("#trades .trades_list").empty(),$("#gasks .table").empty(),$("#gbids .table").empty(),$("#asks .table").empty(),$("#bids .table").empty(),this.setFirstRecord(function(){b.initWebSocket(),b.klineTradeInit=!0,b.setAssistantData()})},setAssistantData:function(){var a=this;a.websocketRedister()},setTitle:function(){document.title=(null==this.curPrice?"":this.curPrice+" ")+this.title},dateFormatTf:function(a){return(a<10?"0":"")+a},dateFormat:function(a){return a.getFullYear()+"-"+this.dateFormatTf(a.getMonth()+1)+"-"+this.dateFormatTf(a.getDate())+" "+this.dateFormatTf(a.getHours())+":"+this.dateFormatTf(a.getMinutes())+":"+this.dateFormatTf(a.getSeconds())},dateInit:function(b){var a=new Date;b&&a.setTime(b),$(".m_rightbot").text(this.dateFormat(a));var c=this;setInterval(function(){a.setTime(a.getTime()+1e3),$(".m_rightbot").text(c.dateFormat(a))},1e3)},setFirstRecord:function(e){var d=this,a=this.symbol||"chbtcbtccny",b=DOMAIN_TRANS+"/depth?symbol="+a+"&lastTime=0&length=10&depth=0";$.getJSON(b,function(f){d.updateDepth(f["return"])});var c=DOMAIN_TRANS+"/getLastTrades?symbol="+a+"&last_trade_tid="+d.last_trade_tid;$.getJSON(c,function(g){var l=g.data;if(null!=l&&l.length>0){for(var m="",k=l.length-1;k>=0;k--){d.tradeDate.setTime(1e3*l[k].date);var j=d.dateFormatTf(d.tradeDate.getHours())+":"+d.dateFormatTf(d.tradeDate.getMinutes())+":"+d.dateFormatTf(d.tradeDate.getSeconds()),n=d.fixNumber(l[k].price,d.moneyDecimal[d.symbol]),h=d.fixNumber(l[k].amount,d.coinDecimal[d.symbol]),f=h.split(".");m+="<ul><li class='tm'>"+j+"</li><li class='pr-"+("buy"==l[k].type?"green":"red")+"'>"+n+"</li><li class='vl'>"+f[0]+"<g>."+f[1]+"</g></li></ul>"}$("#trades .trades_list").html(m),d.curPrice=d.fixNumber(l[l.length-1].price,d.moneyDecimal[d.symbol]),$("div#price").attr("class","buy"==l[l.length-1].type?"green":"red").text(d.curPrice),d.last_trade_tid=l[l.length-1].tid}$.isFunction(e)&&e()})},ajaxRedister:function(){debugger;var d=this,a=this.symbol||"chbtcbtccny",b=DOMAIN_TRANS+"/depth?symbol="+a+"&lastTime=0&length=10&depth=0&random="+1e4*Math.random();$.getJSON(b,function(e){d.updateDepth(e["return"])});var c=DOMAIN_TRANS+"/getLastTrades?symbol="+a+"&last_trade_tid="+d.last_trade_tid+"&random="+1e4*Math.random();$.getJSON(c,function(e){d.pushTrades(e.data),d.klineTradeInit=!0}),setTimeout(function(){d.setAssistantData()},1e3),clear_refresh_counter()},websocketRedister:function(){var a=this;0!=parent.ajaxRun&&(!parent.webSocket||!parent.webSocket.socket||parent.webSocket&&parent.webSocket.socket&&parent.webSocket.socket.readyState!=WebSocket.OPEN)&&a.ajaxRedister()},fixNumber:function(f,d){for(var f=parseFloat(f).toFixed(8),d=d||0,g=f.indexOf(".")==-1,h=f.split(".")[0],c=g?"0":f.split(".")[1],e=c.split(""),a=".",b=0;b<d;b++)a+=e[b]?e[b]:"0";return d>0?parseFloat(h+a).toFixed(d):parseInt(h)},pushTrades:function(m){for(var n=this,k=$("#trades .trades_list"),b="",f=0;f<m.length;f++){var o=m[f];if(f>=m.length-this.tradesLimit){if(o.tid<=n.last_trade_tid)continue;this.tradeDate.setTime(1e3*o.date);var c=this.dateFormatTf(this.tradeDate.getHours())+":"+this.dateFormatTf(this.tradeDate.getMinutes())+":"+this.dateFormatTf(this.tradeDate.getSeconds()),a=this.fixNumber(o.price,this.moneyDecimal[this.symbol]),d=this.fixNumber(o.amount,this.coinDecimal[this.symbol]),g=d.split(".");b=this.klineTradeInit?"<ul class='newul'><li class='tm'>"+c+"</li><li class='pr-"+("buy"==o.type?"green":"red")+"'>"+a+"</li><li class='vl'>"+g[0]+"<g>."+g[1]+"</g></li></ul>"+b:"<ul><li class='tm'>"+c+"</li><li class='pr-"+("buy"==o.type?"green":"red")+"'>"+a+"</li><li class='vl'>"+g[0]+"<g>."+g[1]+"</g></li></ul>"+b}}var e=0;m&&m.length>10&&(e=m.length-10);var l=this;if(this.klineTradeInit){clearInterval(h);var h=setInterval(function(){var i=m[e];return"object"==typeof i&&(l.curPrice=l.fixNumber(i.price,l.moneyDecimal[l.symbol]),$("div#price").attr("class","buy"==i.type?"green":"red").text(l.curPrice),e++,void(e>=m.length&&clearInterval(h)))},100)}else m.length>0&&(l.curPrice=l.fixNumber(m[m.length-1].price,l.moneyDecimal[l.symbol]),$("div#price").attr("class","buy"==m[m.length-1].type?"green":"red").text(l.curPrice));m&&m.length>0&&(n.last_trade_tid=m[m.length-1].tid),this.klineTradeInit?k.prepend(b):k.append(b),b=null,k.find("ul.newul").slideDown(1e3,function(){$(this).removeClass("newul")}),k.find("ul:gt("+(this.tradesLimit-1)+")").remove()},updateDepth:function(c){if(window._set_current_depth(c),c)if($("#gasks .table").html(this.getgview(this.getgasks(c.asks))),$("#gbids .table").html(this.getgview(this.getgbids(c.bids))),null==this.lastDepth)this.lastDepth={},this.lastDepth.asks=this.getAsks(c.asks,this.depthShowSize),this.depthInit(this.lastDepth.asks,$("#asks .table")),this.lastDepth.bids=this.getBids(c.bids,this.depthShowSize),this.depthInit(this.lastDepth.bids,$("#bids .table"));else{var j=$("#asks .table");j.find("div.remove").remove(),j.find("div.add").removeClass("add");var h=this.getAsks(c.asks,this.depthShowSize),b=this.lastDepth.asks;this.lastDepth.asks=h,this.asksAndBids(h.slice(0),b,j);var i=$("#bids .table");i.find("div.remove").remove(),i.find("div.add").removeClass("add");var g=this.getBids(c.bids,this.depthShowSize),a=this.lastDepth.bids;this.lastDepth.bids=g,this.asksAndBids(g.slice(0),a,i);var k=$(window.top.document.body).find("#sellUnitPrice"),f=$(window.top.document.body).find("#buyUnitPrice");if(""==f.val())try{f.val(c.asks[c.asks.length-1][0])}catch(d){}if(""==k.val())try{k.val(c.bids[0][0])}catch(d){}}},depthInit:function(f,h){if(h.empty(),f&&f.length>0){for(var g,b="",e=0;e<f.length;e++){var a=(f[e][0]+"").split("."),d=this.getPrice(a,g);g=a[0],a=(f[e][1]+"").split(".");var c=this.getAmount(a);b+="<div class='row'><span class='price'>"+d[0]+"<g>."+d[1]+"</g></span> <span class='amount'>"+c[0]+"<g>."+c[1]+"</g></span></div>"}h.append(b),b=null}},asksAndBids:function(b,c,l){for(var f=0;f<c.length;f++){for(var n=!1,d=0;d<b.length;d++)if(c[f][0]==b[d][0]){if(n=!0,c[f][1]!=b[d][1]){var a=l.find("div:eq("+f+") .amount");a.addClass(c[f][1]>b[d][1]?"red":"green");var g=this.getAmount((b[d][1]+"").split("."));setTimeout(function(j,i){return function(){j.html(i[0]+"<g>."+i[1]+"</g>"),j.removeClass("red").removeClass("green"),j=null,i=null}}(a,g),500)}b.splice(d,1);break}n||(l.find("div:eq("+f+")").addClass("remove"),c[f][2]=-1)}for(var d=0;d<c.length;d++)for(var f=0;f<b.length;f++)if(b[f][0]>c[d][0]){var k=(b[f][1]+"").split("."),g=this.getAmount(k);l.find("div:eq("+d+")").before("<div class='row add'><span class='price'></span> <span class='amount'>"+g[0]+"<g>."+g[1]+"</g></span></div>"),c.splice(d,0,b[f]),b.splice(f,1);break}for(var h="",f=0;f<b.length;f++){c.push(b[f]);var k=(b[f][1]+"").split("."),g=this.getAmount(k);h+="<div class='row add'><span class='price'></span> <span class='amount'>"+g[0]+"<g>."+g[1]+"</g></span></div>"}h.length>0&&l.append(h),h=null;for(var m,f=0;f<c.length;f++){var o=l.find("div:eq("+f+")");if(!(c[f].length>=3&&c[f][2]==-1)){var k=(c[f][0]+"").split("."),e=this.getPrice(k,m);m=k[0],o.find(".price").html(e[0]+"<g>."+e[1]+"</g>")}}b=null,c=null,l.find("div.add").slideDown(800),setTimeout(function(i,j){return function(){i.slideUp(500,function(){$(this).remove()}),j.removeClass("add")}}(l.find("div.remove"),l.find("div.add")),1e3)},getAsks:function(b,a){return b&&b.length>a&&b.splice(0,b.length-a),b},getBids:function(b,a){return b&&b.length>a&&b.splice(a,b.length-1),b},getgview:function(c){for(var e,d="",b=0;b<c.length;b++){var a=c[b][0].split(".");1==a.length||a[0]!=e?(d+="<div class='row'><span class='price'>"+c[b][0]+"</span> <span class='amount'>"+c[b][1]+"</span></div>",e=a[0]):d+="<div class='row'><span class='price'><h>"+a[0]+".</h>"+a[1]+"</span> <span class='amount'>"+c[b][1]+"</span></div>"}return d},getgasks:function(j){if(!j||j.length<1)return[];var k=j[j.length-1][0],e=j[0][0],a=e-k,d=this.getBlock(a,100),b=Math.abs(Number(Math.log(d)/Math.log(10))).toFixed(0);a/d<2&&(d/=2,b++),d>=1&&(b=0),k=parseInt(k/d)*d,e=parseInt(e/d)*d;for(var h=[],g=0,f=j.length-1;f>=0;f--){if(j[f][0]>k){var c=parseInt(g,10);if(c>0&&h.unshift([Number(k).toFixed(b),c]),k>=e)break;k+=d}g+=j[f][1]}return h},getgbids:function(j){if(!j||j.length<1)return[];var k=j[j.length-1][0],e=j[0][0],a=e-k,d=this.getBlock(a,100),b=Math.abs(Number(Math.log(d)/Math.log(10))).toFixed(0);a/d<2&&(d/=2,b++),d>=1&&(b=0),k=parseInt(k/d)*d,e=parseInt(e/d)*d;for(var h=[],g=0,f=0;f<j.length;f++){if(j[f][0]<e){var c=parseInt(g,10);if(c>0&&h.push([Number(e).toFixed(b),c]),e<=k)break;e-=d}g+=j[f][1]}return h},getBlock:function(a,c){return 0==a||a>c?c:(c/=10,this.getBlock(a,c))},getZeros:function(b){for(var a="";b>0;)b--,a+="0";return a},getPrice:function(a,c){void 0==a[1]&&(a[1]=0);var b=a[0]+"."+a[1];return b=this.fixNumber(parseFloat(b),this.moneyDecimal[this.symbol]),b=b.split("."),[b[0],b[1]]},getAmount:function(a){void 0==a[1]&&(a[1]=0);var b=a[0]+"."+a[1];b=this.fixNumber(parseFloat(b),this.coinDecimal[this.symbol]);var b=b.split(".");return[b[0],b[1]]},setTopTickers:function(c){if(c)for(var a=0;a<c.length;a++){var b=c[a];0==b.moneyType&&1==b.exeByRate?$("#markettop li."+b.symbol).find("span").text(b.ticker.dollar):$("#markettop li."+b.symbol).find("span").text(b.ticker.last)}},setMarketShow:function(e,b,d,c){e+"  "+(b+"/"+d).toUpperCase();this.isBtc123()?($("#markettop li.order_info a").hide(),$("#markettop li.depth_info a").hide()):($("#markettop li.order_info a").show().attr("href","http://www.btc123.com/order?symbol="+this.symbol),$("#markettop li.depth_info a").show().attr("href","http://www.btc123.com/order/order?symbol="+this.symbol))},refreshPage:function(a){a?window.location.href=this.basePath+"/market?symbol="+a:window.location.href=this.basePath+"/market"},refreshUrl:function(a){try{this.browerState++,$("#countView").find("iframe").attr("src","https://www.btc123.com/kline/marketCount/"+a+"?symbol="+a),History.pushState({state:this.browerState},this.title,"?symbol="+a)}catch(b){}},isBtc123:function(){return this.symbol.indexOf("btc123")>=0}},Date.prototype.format=function(b){var c={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(b)&&(b=b.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var a in c)new RegExp("("+a+")").test(b)&&(b=b.replace(RegExp.$1,1==RegExp.$1.length?c[a]:("00"+c[a]).substr((""+c[a]).length)));return b};