function CookieClass(){this.expires=10080,this.path="",this.domain="",this.secure=!1,this.setCookie=function(name,value){var str=name+"="+escape(value);if(this.expires>0){var date=new Date,ms=60*this.expires*1e3;date.setTime(date.getTime()+ms),str+="; expires="+date.toGMTString()}str+="; path=/",""!=this.domain&&(str+="; domain="+this.domain),""!=this.secure&&(str+="; true"),document.cookie=str},this.getCookie=function(name){for(var cookieArray=document.cookie.split("; "),i=0;i<cookieArray.length;i++){var arr=cookieArray[i].split("=");if(arr[0]==name)return unescape(arr[1])}return""},this.deleteCookie=function(name){var date=new Date,ms=1e3;date.setTime(date.getTime()-ms);var str=name+"=no; expires="+date.toGMTString();document.cookie=str},this.showCookie=function(){alert(unescape(document.cookie))}}function setCookieValue(name,value,time){var real_time=-1;time&&(real_time=time);var cookie=new CookieClass;cookie.expires=real_time,cookie.setCookie(name,value)}function getCookieValue(name){var mode=new CookieClass,current_id=mode.getCookie(name);return current_id}function needLoginFirst(){return"true"==jQuery(".entrance").attr("need-forward-login")}function initChat(islogin){if(1!==parseInt(languageType)){if(!islogin)return void jQuery(".entrance").attr("need-forward-login","true").fadeIn(200);var talk_on=getCookieValue(gobal_talk);if((!talk_on||1==Number(talk_on))&&1!=languageType){socket&&socket.emit&&socket.emit("addTalk","{IS_OPEN_TALK:'1',RANDOM:'"+random+"',binary:'"+isBinary+"'}");var nikeName=decodeURI(getCookieValue(gobal_talk_nike_name));nikeName&&(jQuery("#personalName").html(nikeName),jQuery("#inputPersonalName").val(nikeName)),jQuery(".entrance").fadeIn(200),jQuery(".msg_context").empty()}}}function openChat(){return needLoginFirst()?void jQuery(".layerPopChat").show():(socket||socketConnection(!0),send&&(socket.emit&&socket.emit("addTalk","{IS_OPEN_TALK:'1',RANDOM:'"+random+"',binary:'"+isBinary+"'}"),send=!1),jQuery(".chatBodyNew").slideDown(),jQuery(".chatContent").scrollTop(jQuery(".chatContent")[0].scrollHeight),void jQuery(".entrance").hide())}function changeChatPersonalName(){var oldNikeName=getCookieValue(gobal_talk_nike_name),nowNikeName=encodeURI(jQuery(this).val());return oldNikeName&&oldNikeName!=nowNikeName?(showErrorMsg("昵称一个月之内只能修改一次！"),jQuery(this).val(decodeURI(oldNikeName)),jQuery(".show").show(),void jQuery(".edit").hide()):oldNikeName==nowNikeName||jQuery.trim(jQuery("#personalName").html())==nowNikeName?(jQuery(".show").show(),void jQuery(".edit").hide()):(jQuery("#personalName").html(jQuery(this).val()),jQuery(this).val()&&jQuery(this).val().indexOf("管理")!=-1?void showErrorMsg("昵称非法“管理”！请重新输入！"):jQuery(this).val().length>10?void showErrorMsg("请输入10个字符以内的名称！"):(jQuery(this).val()&&setCookieValue(gobal_talk_nike_name,nowNikeName,43200),jQuery(".show").show(),void jQuery(".edit").hide()))}function showErrorMsg(msg){jQuery("#stopTalk").length>0&&jQuery("#stopTalk").remove();var result='<li id="stopTalk" ><p class="speak_other" style="color: red" title="系统信息">系统信息:'+msg+"</p></li>";jQuery(".msg_context li").length>=100&&jQuery(".msg_context li").first().remove(),jQuery(".msg_context").append(result),jQuery(".chatContent").scrollTop(jQuery(".chatContent")[0].scrollHeight)}function clearError(){jQuery(".chatErrorMsg").html("")}function loadTalkMsg(data){if(data)for(var i=0;i<data.length;i++)if(data[i]){var type=data[i].type;"talk"===type&&addMsg(data[i].data)}}function addMsg(data){if(data){for(var result="",i=0;i<data.length;i++){var tmp=data[i];if("onLineCount"!==tmp.email){result+="<li>";var cls="speak_other";jQuery.trim(tmp.uid)===jQuery.trim(md5_code)&&(cls="speak_own");var showName=checkMsg(decodeURI(tmp.userName));tmp.mananger&&1===Number(tmp.mananger)&&(cls="speak_manager",showName="管理员("+showName+")");var emailShow=showName;tmp.email&&(emailShow=tmp.email+"("+showName+")",showName=emailShow),result+='<p class="'+cls+'" title="'+emailShow+'">'+showName+":"+checkMsg(decodeURI(tmp.message))+"</p>",result+='<p class="'+cls+'" style="color:#aab2bd">'+tmp.time+"</p>",result+="</li>",jQuery(".talks").html(tmp.onLineCount),jQuery(".msg_context li").length>=100&&jQuery(".msg_context li").first().remove()}else jQuery(".talks").html(tmp.onLineCount),addMsg(tmp.message)}result&&(jQuery(".msg_context").append(result),jQuery(".chatContent").scrollTop(jQuery(".chatContent")[0].scrollHeight))}}function checkMsg(msg){return msg=msg.replace("'",'"'),msg=msg.replace("<","&#60;"),msg=msg.replace(">","&#62;")}function showChatRulePop(){dialogBoxShadow();var screenWidth=document.documentElement.clientWidth,leftDis=(screenWidth-600)/2;jQuery(".chatRulePop").css("left",leftDis),jQuery(".chatRulePop").show()}function closeChatRulePop(){dialogBoxHidden(),jQuery(".chatRulePop").hide()}function layerPopChatLogin(){location.href="/user/login.do?forward="+encodeURIComponent(location.href)}function layerPopChatCancel(){jQuery(".layerPopChat").hide()}var gobal_talk="TALK_ON",md5_code=jQuery("#md5_code").val(),gobal_talk_nike_name=md5_code,languageType=jQuery("#languageType").val(),random=jQuery("#random").val();jQuery(".chatContent").mouseover(function(){jQuery(this).bind("mousewheel",function(event){var value=0;event.originalEvent.wheelDelta?value=event.originalEvent.wheelDelta:event.originalEvent.detail&&(value=event.originalEvent.detail);var heigh=jQuery(".chatContent")[0].scrollTop;return value<0?heigh+=30:(heigh-=30,heigh=heigh<0?0:heigh),jQuery(".chatContent").scrollTop(heigh),!1})}),jQuery(".chatContent").mouseout(function(){jQuery(this).unbind("mousewheel")}),jQuery(".closePop").click(function(event){var callback={okBack:function(){jQuery(".entrance").hide(500),jQuery(".chatBody").hide(500),setCookieValue(gobal_talk,0,525600)},noBack:void 0};okcoinAlert("可在“用户支持-聊天室”重新打开聊天室!",!1,callback)});var send=!0;jQuery(".entrance .upPopChatWrapper").bind("click",openChat),jQuery(".downPop").click(function(){jQuery(".chatBody").slideUp(300,function(){jQuery(".entrance").show()})}),jQuery(".chatBodyService .right").click(function(){return needLoginFirst()?void jQuery(".layerPopChat").show():(jQuery(".chatBodyService").hide(),void jQuery(".chatBodyNew").slideDown())}),jQuery(".chatBodyService .question").click(function(e){if(needLoginFirst())return e.preventDefault(),void jQuery(".layerPopChat").show()}),jQuery(".chatBodyNew .left").click(function(){jQuery(".chatBodyNew").hide(),jQuery(".chatBodyService").slideDown()}),jQuery(".changeIcon").click(function(){jQuery(".edit").show(),jQuery(".show").hide(),jQuery("#inputPersonalName").focus()}),jQuery("#inputPersonalName").blur(function(){return jQuery(this).attr("enter-pressed")?void jQuery(this).removeAttr("enter-pressed"):void changeChatPersonalName.apply(this)}),jQuery("#inputPersonalName").keyup(function(e){var keyCode=e.keyCode||e.which||e.charCode;13==keyCode&&(changeChatPersonalName.apply(this),jQuery(this).attr("enter-pressed","true"))}),jQuery(".clearScreen").click(function(){jQuery(".chatContent").hide(),jQuery(".msg_context").empty(),jQuery(".chatContent").show()}),jQuery(".speakContent textarea").keydown(function(event){if(13===event.keyCode)return jQuery(".sendMsge").click(),!1}),jQuery(".sendMsge").click(function(){var msg=jQuery(".speakContent textarea").val();if(!msg)return showErrorMsg("请输入信息!"),void jQuery(".speakContent textarea").focus();var url="/dialogSendMsg.do",param={msg:encodeURI(msg),nikeName:encodeURI(jQuery.trim(jQuery("#personalName").html()))};jQuery(this).attr("disable",!0),jQuery.post(url,param,function(data){switch(jQuery(this).attr("disable",!1),Number(data.errorCode)){case 1e4:jQuery(".speakContent textarea").val("");break;case-1e4:showErrorMsg("请先登录！");break;case-10001:showErrorMsg('您已经被禁言！请联系OKCOIN管理员！<a class="" target="_blank" href="http://wpa.b.qq.com/cgi/wpa.php?ln=1&amp;key=XzgwMDA0NTEyNV82MjQ4Nl84MDAwNDUxMjVfMl8">800045125</a>');break;case-10002:showErrorMsg("请输入信息！");break;case-10003:showErrorMsg("请输入昵称！");break;case-10004:showErrorMsg("您输入的话太长了！");break;case-10005:showErrorMsg("昵称非法“管理”！请重新输入！");break;case-10006:showErrorMsg("禁止发送链接！");break;case-10007:showErrorMsg("您输入的内容包含敏感词汇，请修改！");break;case-10008:showErrorMsg("您的昵称输入了非法语句！");break;case-10009:showErrorMsg("请输入10个字符以内的昵称！");break;case-10010:showErrorMsg("您没有任何交易信息，无法发送消息!")}},"JSON")});